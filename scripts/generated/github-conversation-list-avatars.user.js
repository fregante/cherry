// ==UserScript==
// @name         GitHub conversation list avatars
// @version      2
// @description  Add avatars in GitHub's conversation list
// @author       kidonng
// @namespace    https://github.com/kidonng/cherry
// @match        https://github.com/*
// ==/UserScript==
(()=>{var ge=Object.create;var W=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var we=Object.getOwnPropertyNames;var Se=Object.getPrototypeOf,xe=Object.prototype.hasOwnProperty;var Me=r=>W(r,"__esModule",{value:!0});var Q=(r,s)=>()=>(s||r((s={exports:{}}).exports,s),s.exports);var be=(r,s,d)=>{if(s&&typeof s=="object"||typeof s=="function")for(let S of we(s))!xe.call(r,S)&&S!=="default"&&W(r,S,{get:()=>s[S],enumerable:!(d=ye(s,S))||d.enumerable});return r},Ae=r=>be(Me(W(r!=null?ge(Se(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var X=Q(($,K)=>{(function(r,s){typeof define=="function"&&define.amd?define([],s):typeof $=="object"?K.exports=s():r.SelectorSet=s()})($,function(){"use strict";function r(){if(!(this instanceof r))return new r;this.size=0,this.uid=0,this.selectors=[],this.selectorObjects={},this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var s=window.document.documentElement,d=s.matches||s.webkitMatchesSelector||s.mozMatchesSelector||s.oMatchesSelector||s.msMatchesSelector;r.prototype.matchesSelector=function(o,f){return d.call(o,f)},r.prototype.querySelectorAll=function(o,f){return f.querySelectorAll(o)},r.prototype.indexes=[];var S=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;r.prototype.indexes.push({name:"ID",selector:function(f){var l;if(l=f.match(S))return l[0].slice(1)},element:function(f){if(f.id)return[f.id]}});var A=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;r.prototype.indexes.push({name:"CLASS",selector:function(f){var l;if(l=f.match(A))return l[0].slice(1)},element:function(f){var l=f.className;if(l){if(typeof l=="string")return l.split(/\s/);if(typeof l=="object"&&"baseVal"in l)return l.baseVal.split(/\s/)}}});var C=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;r.prototype.indexes.push({name:"TAG",selector:function(f){var l;if(l=f.match(C))return l[0].toUpperCase()},element:function(f){return[f.nodeName.toUpperCase()]}}),r.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}};var O;typeof window.Map=="function"?O=window.Map:O=function(){function o(){this.map={}}return o.prototype.get=function(f){return this.map[f+" "]},o.prototype.set=function(f,l){this.map[f+" "]=l},o}();var N=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function P(o,f){o=o.slice(0).concat(o.default);var l=o.length,m,h,w,p,x=f,g,v,y=[];do if(N.exec(""),(w=N.exec(x))&&(x=w[3],w[2]||!x)){for(m=0;m<l;m++)if(v=o[m],g=v.selector(w[1])){for(h=y.length,p=!1;h--;)if(y[h].index===v&&y[h].key===g){p=!0;break}p||y.push({index:v,key:g});break}}while(w);return y}function E(o,f){var l,m,h;for(l=0,m=o.length;l<m;l++)if(h=o[l],f.isPrototypeOf(h))return h}r.prototype.logDefaultIndexUsed=function(){},r.prototype.add=function(o,f){var l,m,h,w,p,x,g,v,y=this.activeIndexes,M=this.selectors,I=this.selectorObjects;if(typeof o=="string"){for(l={id:this.uid++,selector:o,data:f},I[l.id]=l,g=P(this.indexes,o),m=0;m<g.length;m++)v=g[m],w=v.key,h=v.index,p=E(y,h),p||(p=Object.create(h),p.map=new O,y.push(p)),h===this.indexes.default&&this.logDefaultIndexUsed(l),x=p.map.get(w),x||(x=[],p.map.set(w,x)),x.push(l);this.size++,M.push(o)}},r.prototype.remove=function(o,f){if(typeof o=="string"){var l,m,h,w,p,x,g,v,y=this.activeIndexes,M=this.selectors=[],I=this.selectorObjects,k={},F=arguments.length===1;for(l=P(this.indexes,o),h=0;h<l.length;h++)for(m=l[h],w=y.length;w--;)if(x=y[w],m.index.isPrototypeOf(x)){if(g=x.map.get(m.key),g)for(p=g.length;p--;)v=g[p],v.selector===o&&(F||v.data===f)&&(g.splice(p,1),k[v.id]=!0);break}for(h in k)delete I[h],this.size--;for(h in I)M.push(I[h].selector)}};function L(o,f){return o.id-f.id}return r.prototype.queryAll=function(o){if(!this.selectors.length)return[];var f={},l=[],m=this.querySelectorAll(this.selectors.join(", "),o),h,w,p,x,g,v,y,M;for(h=0,p=m.length;h<p;h++)for(g=m[h],v=this.matches(g),w=0,x=v.length;w<x;w++)M=v[w],f[M.id]?y=f[M.id]:(y={id:M.id,selector:M.selector,data:M.data,elements:[]},f[M.id]=y,l.push(y)),y.elements.push(g);return l.sort(L)},r.prototype.matches=function(o){if(!o)return[];var f,l,m,h,w,p,x,g,v,y,M,I=this.activeIndexes,k={},F=[];for(f=0,h=I.length;f<h;f++)if(x=I[f],g=x.element(o),g){for(l=0,w=g.length;l<w;l++)if(v=x.map.get(g[l]))for(m=0,p=v.length;m<p;m++)y=v[m],M=y.id,!k[M]&&this.matchesSelector(o,y.selector)&&(k[M]=!0,F.push(y))}return F.sort(L)},r})});var ee=Q((_,Z)=>{(function(r,s){typeof _=="object"&&typeof Z!="undefined"?s(_,X()):typeof define=="function"&&define.amd?define(["exports","selector-set"],s):s(r.SelectorObserver={},r.SelectorSet)})(_,function(r,s){"use strict";s=s&&s.hasOwnProperty("default")?s.default:s;var d=null,S=null,A=[];function C(e,t){var n=[];function a(){var c=n;n=[],t(c)}function i(){for(var c=arguments.length,u=Array(c),b=0;b<c;b++)u[b]=arguments[b];n.push(u),n.length===1&&O(e,a)}return i}function O(e,t){S||(S=new MutationObserver(N)),d||(d=e.createElement("div"),S.observe(d,{attributes:!0})),A.push(t),d.setAttribute("data-twiddle",""+Date.now())}function N(){var e=A;A=[];for(var t=0;t<e.length;t++)try{e[t]()}catch(n){setTimeout(function(){throw n},0)}}var P=new WeakMap,E=new WeakMap,L=new WeakMap,o=new WeakMap;function f(e,t){for(var n=0;n<t.length;n++){var a=t[n],i=a[0],c=a[1],u=a[2];i===v?(l(u,c),m(u,c)):i===y?h(u,c):i===M&&w(e.observers,c)}}function l(e,t){if(t instanceof e.elementConstructor){var n=P.get(t);if(n||(n=[],P.set(t,n)),n.indexOf(e.id)===-1){var a=void 0;if(e.initialize&&(a=e.initialize.call(void 0,t)),a){var i=E.get(t);i||(i={},E.set(t,i)),i[""+e.id]=a}n.push(e.id)}}}function m(e,t){if(t instanceof e.elementConstructor){var n=o.get(t);if(n||(n=[],o.set(t,n)),n.indexOf(e.id)===-1){e.elements.push(t);var a=E.get(t),i=a?a[""+e.id]:null;if(i&&i.add&&i.add.call(void 0,t),e.subscribe){var c=e.subscribe.call(void 0,t);if(c){var u=L.get(t);u||(u={},L.set(t,u)),u[""+e.id]=c}}e.add&&e.add.call(void 0,t),n.push(e.id)}}}function h(e,t){if(t instanceof e.elementConstructor){var n=o.get(t);if(!!n){var a=e.elements.indexOf(t);if(a!==-1&&e.elements.splice(a,1),a=n.indexOf(e.id),a!==-1){var i=E.get(t),c=i?i[""+e.id]:null;if(c&&c.remove&&c.remove.call(void 0,t),e.subscribe){var u=L.get(t),b=u?u[""+e.id]:null;b&&b.unsubscribe&&b.unsubscribe()}e.remove&&e.remove.call(void 0,t),n.splice(a,1)}n.length===0&&o.delete(t)}}}function w(e,t){var n=o.get(t);if(!!n){for(var a=n.slice(0),i=0;i<a.length;i++){var c=e[a[i]];if(!!c){var u=c.elements.indexOf(t);u!==-1&&c.elements.splice(u,1);var b=E.get(t),D=b?b[""+c.id]:null;D&&D.remove&&D.remove.call(void 0,t);var j=L.get(t),q=j?j[""+c.id]:null;q&&q.unsubscribe&&q.unsubscribe(),c.remove&&c.remove.call(void 0,t)}}o.delete(t)}}var p=null;function x(e){if(p===null){var t=e.createElement("div"),n=e.createElement("div"),a=e.createElement("div");t.appendChild(n),n.appendChild(a),t.innerHTML="",p=a.parentNode!==n}return p}function g(e){return"matches"in e||"webkitMatchesSelector"in e||"mozMatchesSelector"in e||"oMatchesSelector"in e||"msMatchesSelector"in e}var v=1,y=2,M=3;function I(e,t,n){for(var a=0;a<n.length;a++){var i=n[a];i.type==="childList"?(k(e,t,i.addedNodes),F(e,t,i.removedNodes)):i.type==="attributes"&&B(e,t,i.target)}x(e.ownerDocument)&&ae(e,t)}function k(e,t,n){for(var a=0;a<n.length;a++){var i=n[a];if(g(i))for(var c=e.selectorSet.matches(i),u=0;u<c.length;u++){var b=c[u].data;t.push([v,i,b])}if("querySelectorAll"in i)for(var D=e.selectorSet.queryAll(i),j=0;j<D.length;j++)for(var q=D[j],ve=q.data,U=q.elements,V=0;V<U.length;V++)t.push([v,U[V],ve])}}function F(e,t,n){for(var a=0;a<n.length;a++){var i=n[a];if("querySelectorAll"in i){t.push([M,i]);for(var c=i.querySelectorAll("*"),u=0;u<c.length;u++)t.push([M,c[u]])}}}function B(e,t,n){if(g(n))for(var a=e.selectorSet.matches(n),i=0;i<a.length;i++){var c=a[i].data;t.push([v,n,c])}if("querySelectorAll"in n){var u=o.get(n);if(u)for(var b=0;b<u.length;b++){var D=e.observers[u[b]];D&&(e.selectorSet.matchesSelector(n,D.selector)||t.push([y,n,D]))}}}function re(e,t,n){if("querySelectorAll"in n){B(e,t,n);for(var a=n.querySelectorAll("*"),i=0;i<a.length;i++)B(e,t,a[i])}}function ie(e,t,n){for(var a=0;a<n.length;a++)for(var i=n[a],c=i.form?i.form.elements:e.rootNode.querySelectorAll("input"),u=0;u<c.length;u++)B(e,t,c[u])}function ae(e,t){for(var n=0;n<e.observers.length;n++){var a=e.observers[n];if(a)for(var i=a.elements,c=0;c<i.length;c++){var u=i[c];u.parentNode||t.push([M,u])}}}function oe(e,t){var n=e.readyState;n==="interactive"||n==="complete"?O(e,t):e.addEventListener("DOMContentLoaded",O(e,t))}var se=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe=0;function R(e){this.rootNode=e.nodeType===9?e.documentElement:e,this.ownerDocument=e.nodeType===9?e:e.ownerDocument,this.observers=[],this.selectorSet=new s,this.mutationObserver=new MutationObserver(ue.bind(this,this)),this._scheduleAddRootNodes=C(this.ownerDocument,ce.bind(this,this)),this._handleThrottledChangedTargets=C(this.ownerDocument,he.bind(this,this)),this.rootNode.addEventListener("change",de.bind(this,this),!1),oe(this.ownerDocument,le.bind(this,this))}R.prototype.disconnect=function(){this.mutationObserver.disconnect()},R.prototype.observe=function(e,t){var n=void 0;typeof t=="function"?n={selector:e,initialize:t}:(typeof t=="undefined"?"undefined":se(t))==="object"?(n=t,n.selector=e):n=e;var a=this,i={id:fe++,selector:n.selector,initialize:n.initialize,add:n.add,remove:n.remove,subscribe:n.subscribe,elements:[],elementConstructor:n.hasOwnProperty("constructor")?n.constructor:this.ownerDocument.defaultView.Element,abort:function(){a._abortObserving(i)}};return this.selectorSet.add(i.selector,i),this.observers[i.id]=i,this._scheduleAddRootNodes(),i},R.prototype._abortObserving=function(e){for(var t=e.elements,n=0;n<t.length;n++)h(e,t[n]);this.selectorSet.remove(e.selector,e),delete this.observers[e.id]},R.prototype.triggerObservers=function(e){var t=[];re(this,t,e),f(this,t)};function le(e){e.mutationObserver.observe(e.rootNode,{childList:!0,attributes:!0,subtree:!0}),e._scheduleAddRootNodes()}function ce(e){var t=[];k(e,t,[e.rootNode]),f(e,t)}function ue(e,t){var n=[];I(e,n,t),f(e,n)}function de(e,t){e._handleThrottledChangedTargets(t.target)}function he(e,t){var n=[];ie(e,n,t),f(e,n)}var G=void 0;function H(){return G||(G=new R(window.document)),G}function me(){var e;return(e=H()).observe.apply(e,arguments)}function pe(){var e;return(e=H()).triggerObservers.apply(e,arguments)}r.getDocumentObserver=H,r.observe=me,r.triggerObservers=pe,r.default=R,Object.defineProperty(r,"__esModule",{value:!0})})});var Oe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","animation","audio","canvas","circle","clipPath","color-profile","cursor","defs","desc","discard","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","handler","hkern","iframe","image","line","linearGradient","listener","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","prefetch","radialGradient","rect","script","set","solidColor","stop","style","svg","switch","symbol","tbreak","text","textArea","textPath","title","tref","tspan","unknown","use","video","view","vkern"],T=new Set(Oe);T.delete("a");T.delete("audio");T.delete("canvas");T.delete("iframe");T.delete("script");T.delete("video");var Ce=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,Ie=r=>r===DocumentFragment,De=(r,s)=>{for(let[d,S]of Object.entries(s))d.startsWith("-")?r.style.setProperty(d,S):typeof S=="number"&&!Ce.test(d)?r.style[d]=`${S}px`:r.style[d]=S},Ne=r=>typeof r=="string"?T.has(r)?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r):Ie(r)?document.createDocumentFragment():r(r.defaultProps),Y=(r,s,d)=>{d!=null&&(/^xlink[AHRST]/.test(s)?r.setAttributeNS("http://www.w3.org/1999/xlink",s.replace("xlink","xlink:").toLowerCase(),d):r.setAttribute(s,d))},z=(r,s)=>{for(let d of s)d instanceof Node?r.appendChild(d):Array.isArray(d)?z(r,d):typeof d!="boolean"&&typeof d!="undefined"&&d!==null&&r.appendChild(document.createTextNode(d))},ke=(r,s,...d)=>{var S;let A=Ne(r);if(z(A,d),A instanceof DocumentFragment||!s)return A;for(let[C,O]of Object.entries(s))if(C==="htmlFor"&&(C="for"),C==="class"||C==="className"){let N=(S=A.getAttribute("class"))!==null&&S!==void 0?S:"";Y(A,"class",(N+" "+String(O)).trim())}else if(C==="style")De(A,O);else if(C.startsWith("on")){let N=C.slice(2).toLowerCase().replace(/^-/,"");A.addEventListener(N,O)}else C==="dangerouslySetInnerHTML"&&"__html"in O?A.innerHTML=O.__html:C!=="key"&&O!==!1&&Y(A,C,O===!0?"":O);return A},Ee=typeof DocumentFragment=="function"?DocumentFragment:()=>{},Le={createElement:ke,Fragment:Ee},J=Le;var te=Ae(ee()),ne="gcla-processed";(0,te.observe)(`:is(.js-issue-row, .js-pinned-issue-list-item) [data-hovercard-type="user"]:not(.${ne})`,{add(r){r.classList.add(ne);let s=r.textContent,d=`@${s}`,S=document.querySelector(`[alt="${d}"]`)?.src||`https://avatars.githubusercontent.com/${s}?size=32`;r.prepend(J.createElement("img",{className:"avatar avatar-user",style:{transform:"translateY(-1.5px)"},src:S,width:"16",height:"16",alt:d,loading:"lazy",decoding:"async"})," ")}});})();
