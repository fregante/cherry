// ==UserScript==
// @name         GitHub theme switch
// @version      1.0.1
// @description  Add theme preferences switch to GitHub's profile dropdown.
// @author       kidonng
// @namespace    https://github.com/kidonng/cherry
// @match        https://github.com/*
// ==/UserScript==
(()=>{var M=Object.create;var u=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var T=t=>u(t,"__esModule",{value:!0});var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var k=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of P(e))!E.call(t,s)&&s!=="default"&&u(t,s,{get:()=>e[s],enumerable:!(r=x(e,s))||r.enumerable});return t},A=t=>k(T(u(t!=null?M(q(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var b=m((B,d)=>{"use strict";var H=Symbol("null"),j=0;d.exports=class extends Map{constructor(){super();this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;let[e]=arguments;if(e!=null){if(typeof e[Symbol.iterator]!="function")throw new TypeError(typeof e+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(let[r,s]of e)this.set(r,s)}}_getPublicKeys(e,r=!1){if(!Array.isArray(e))throw new TypeError("The keys parameter must be an array");let s=this._getPrivateKey(e,r),n;return s&&this._publicKeys.has(s)?n=this._publicKeys.get(s):r&&(n=[...e],this._publicKeys.set(s,n)),{privateKey:s,publicKey:n}}_getPrivateKey(e,r=!1){let s=[];for(let n of e){n===null&&(n=H);let o=typeof n=="object"||typeof n=="function"?"_objectHashes":typeof n=="symbol"?"_symbolHashes":!1;if(!o)s.push(n);else if(this[o].has(n))s.push(this[o].get(n));else if(r){let i=`@@mkm-ref-${j++}@@`;this[o].set(n,i),s.push(i)}else return!1}return JSON.stringify(s)}set(e,r){let{publicKey:s}=this._getPublicKeys(e,!0);return super.set(s,r)}get(e){let{publicKey:r}=this._getPublicKeys(e);return super.get(r)}has(e){let{publicKey:r}=this._getPublicKeys(e);return super.has(r)}delete(e){let{publicKey:r,privateKey:s}=this._getPublicKeys(e);return Boolean(r&&super.delete(r)&&this._publicKeys.delete(s))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}});var K=m((J,g)=>{"use strict";var L=()=>{let t={};return t.promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t};g.exports=L});var w=m((N,v)=>{"use strict";var C=b(),D=K(),p=new C,F=()=>document.readyState==="interactive"||document.readyState==="complete",I=(t,{target:e=document,stopOnDomReady:r=!0,timeout:s=1/0}={})=>{let n=[e,t,r,s],o=p.get(n);if(o)return o;let i,c=D(),{promise:l}=c;p.set(n,l);let a=()=>{cancelAnimationFrame(i),p.delete(n,l),c.resolve()};return s!==1/0&&setTimeout(a,s),function S(){let f=e.querySelector(t);f?(c.resolve(f),a()):r&&F()?a():i=requestAnimationFrame(S)}(),Object.assign(l,{stop:a})};v.exports=I});var y=t=>{if(t==null)return new DocumentFragment;let e=document.createElement("template");return e.innerHTML=t,e.content};y.one=t=>{var e;return(e=y(t).firstElementChild)!==null&&e!==void 0?e:void 0};var h=y;var _=A(w()),R=async()=>{let e=await(await fetch("https://github.com/settings/appearance")).text(),s=h(e).querySelector(".js-color-mode-settings");s.classList.add("mt-1","ml-1"),s.querySelector(".flex-column").classList.remove("flex-lg-row");for(let n of s.querySelectorAll("img"))n.parentElement.style.border="none",n.parentElement.style.fontWeight="normal",n.remove();for(let n of s.querySelectorAll(".position-relative"))n.classList.remove("mb-4");return s};(async()=>{let t=document.createElement("style");t.innerHTML=`
  .github-theme-switch:hover {
    color: var(--color-text-primary);
    background-color: var(--color-bg-overlay);
  }
  `,document.head.appendChild(t);let e=document.createElement("span");e.setAttribute("role","menuitem"),e.classList.add("dropdown-item","github-theme-switch"),e.textContent="Theme preference";let r=await(0,_.default)('.dropdown-item[href="https://gist.github.com/mine"]',{stopOnDomReady:!1}),s=await R();r.after(e,s)})();})();
