// ==UserScript==
// @name         Notion Localization
// @version      5
// @description  Enable Notion's native localization for more languages
// @author       kidonng
// @namespace    https://github.com/kidonng/cherry
// @match        https://www.notion.so/*
// @run-at       document-start
// ==/UserScript==
(()=>{var S=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","animation","audio","canvas","circle","clipPath","color-profile","cursor","defs","desc","discard","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","handler","hkern","iframe","image","line","linearGradient","listener","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","prefetch","radialGradient","rect","script","set","solidColor","stop","style","svg","switch","symbol","tbreak","text","textArea","textPath","title","tref","tspan","unknown","use","video","view","vkern"],l=new Set(S);l.delete("a");l.delete("audio");l.delete("canvas");l.delete("iframe");l.delete("script");l.delete("video");var x=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,N=e=>e===DocumentFragment,C=(e,n)=>{for(let[t,s]of Object.entries(n))t.startsWith("-")?e.style.setProperty(t,s):typeof s=="number"&&!x.test(t)?e.style[t]=`${s}px`:e.style[t]=s},L=e=>typeof e=="string"?l.has(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e):N(e)?document.createDocumentFragment():e(e.defaultProps),m=(e,n,t)=>{t!=null&&(/^xlink[AHRST]/.test(n)?e.setAttributeNS("http://www.w3.org/1999/xlink",n.replace("xlink","xlink:").toLowerCase(),t):e.setAttribute(n,t))},d=(e,n)=>{for(let t of n)t instanceof Node?e.appendChild(t):Array.isArray(t)?d(e,t):typeof t!="boolean"&&typeof t!="undefined"&&t!==null&&e.appendChild(document.createTextNode(t))},F=(e,n,...t)=>{var s;let a=L(e);if(d(a,t),a instanceof DocumentFragment||!n)return a;for(let[o,r]of Object.entries(n))if(o==="htmlFor"&&(o="for"),o==="class"||o==="className"){let i=(s=a.getAttribute("class"))!==null&&s!==void 0?s:"";m(a,"class",(i+" "+String(r)).trim())}else if(o==="style")C(a,r);else if(o.startsWith("on")){let i=o.slice(2).toLowerCase().replace(/^-/,"");a.addEventListener(i,r)}else o==="dangerouslySetInnerHTML"&&"__html"in r?a.innerHTML=r.__html:o!=="key"&&r!==!1&&m(a,o,r===!0?"":r);return a},k=typeof DocumentFragment=="function"?DocumentFragment:()=>{},_={createElement:F,Fragment:k},u=_;var c=e=>{if(e==null)return new DocumentFragment;let n=document.createElement("template");return n.innerHTML=e,n.content};c.one=e=>{var n;return(n=c(e).firstElementChild)!==null&&n!==void 0?n:void 0};var p=c;(async()=>{let e=localStorage.getItem("ajs_user_traits");if(!e)return;let{app_version:n,locale:t,is_desktop:s,preferred_locale:a}=JSON.parse(e),o="i10n-meta",r="i10n-messages";if(localStorage.getItem(o)===`${n}-${t}`){let i=()=>document.documentElement.prepend(u.createElement("script",{id:"messages",type:"application/json","data-locale":a},localStorage.getItem(r)));s?document.addEventListener("readystatechange",i,{once:!0}):i();return}try{let i=await fetch("/api/v3/getAssetsJsonV2",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({hash:""})}),{localeHtml:f,version:g}=await i.json();if(!(t in f))return;let h=f[t],y=await(await fetch(h)).text(),w=p(y),{textContent:v}=w.querySelector("#messages");localStorage.setItem(o,`${g}-${t}`),localStorage.setItem(r,v),confirm("Notion Localization data updated successfully \u2728, would you like to reload?")&&(location.pathname="/")}catch(i){alert(`Notion Localization data failed to update \u{1F622}

${i}`)}})();})();
