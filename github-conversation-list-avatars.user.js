// ==UserScript==
// @name         GitHub conversation list avatars
// @version      4
// @description  Add avatars in GitHub's conversation list
// @author       kidonng
// @namespace    https://github.com/kidonng/cherry
// @match        https://github.com/*
// ==/UserScript==
(()=>{var z=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","animation","audio","canvas","circle","clipPath","color-profile","cursor","defs","desc","discard","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","handler","hkern","iframe","image","line","linearGradient","listener","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","prefetch","radialGradient","rect","script","set","solidColor","stop","style","svg","switch","symbol","tbreak","text","textArea","textPath","title","tref","tspan","unknown","use","video","view","vkern"],p=new Set(z);p.delete("a");p.delete("audio");p.delete("canvas");p.delete("iframe");p.delete("script");p.delete("video");var J=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,K=e=>e===DocumentFragment,X=(e,n)=>{for(let[t,o]of Object.entries(n))t.startsWith("-")?e.style.setProperty(t,o):typeof o=="number"&&!J.test(t)?e.style[t]=`${o}px`:e.style[t]=o},Y=e=>typeof e=="string"?p.has(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e):K(e)?document.createDocumentFragment():e(e.defaultProps),q=(e,n,t)=>{t!=null&&(/^xlink[AHRST]/.test(n)?e.setAttributeNS("http://www.w3.org/1999/xlink",n.replace("xlink","xlink:").toLowerCase(),t):e.setAttribute(n,t))},j=(e,n)=>{for(let t of n)t instanceof Node?e.appendChild(t):Array.isArray(t)?j(e,t):typeof t!="boolean"&&typeof t<"u"&&t!==null&&e.appendChild(document.createTextNode(t))},Z=(e,n,...t)=>{var o;let r=Y(e);if(j(r,t),r instanceof DocumentFragment||!n)return r;for(let[a,i]of Object.entries(n))if(a==="htmlFor"&&(a="for"),a==="class"||a==="className"){let s=(o=r.getAttribute("class"))!==null&&o!==void 0?o:"";q(r,"class",(s+" "+String(i)).trim())}else if(a==="style")X(r,i);else if(a.startsWith("on")){let s=a.slice(2).toLowerCase().replace(/^-/,"");r.addEventListener(s,i)}else a==="dangerouslySetInnerHTML"&&"__html"in i?r.innerHTML=i.__html:a!=="key"&&i!==!1&&q(r,a,i===!0?"":i);return r},ee=typeof DocumentFragment=="function"?DocumentFragment:()=>{},te={createElement:Z,Fragment:ee},g=te;function d(){if(!(this instanceof d))return new d;this.size=0,this.uid=0,this.selectors=[],this.selectorObjects={},this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var y=window.document.documentElement,ne=y.matches||y.webkitMatchesSelector||y.mozMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;d.prototype.matchesSelector=function(e,n){return ne.call(e,n)};d.prototype.querySelectorAll=function(e,n){return n.querySelectorAll(e)};d.prototype.indexes=[];var re=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;d.prototype.indexes.push({name:"ID",selector:function(n){var t;if(t=n.match(re))return t[0].slice(1)},element:function(n){if(n.id)return[n.id]}});var oe=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;d.prototype.indexes.push({name:"CLASS",selector:function(n){var t;if(t=n.match(oe))return t[0].slice(1)},element:function(n){var t=n.className;if(t){if(typeof t=="string")return t.split(/\s/);if(typeof t=="object"&&"baseVal"in t)return t.baseVal.split(/\s/)}}});var ae=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;d.prototype.indexes.push({name:"TAG",selector:function(n){var t;if(t=n.match(ae))return t[0].toUpperCase()},element:function(n){return[n.nodeName.toUpperCase()]}});d.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}};var D;typeof window.Map=="function"?D=window.Map:D=function(){function e(){this.map={}}return e.prototype.get=function(n){return this.map[n+" "]},e.prototype.set=function(n,t){this.map[n+" "]=t},e}();var P=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function B(e,n){e=e.slice(0).concat(e.default);var t=e.length,o,r,a,i,s=n,l,f,c=[];do if(P.exec(""),(a=P.exec(s))&&(s=a[3],a[2]||!s)){for(o=0;o<t;o++)if(f=e[o],l=f.selector(a[1])){for(r=c.length,i=!1;r--;)if(c[r].index===f&&c[r].key===l){i=!0;break}i||c.push({index:f,key:l});break}}while(a);return c}function ie(e,n){var t,o,r;for(t=0,o=e.length;t<o;t++)if(r=e[t],n.isPrototypeOf(r))return r}d.prototype.logDefaultIndexUsed=function(){};d.prototype.add=function(e,n){var t,o,r,a,i,s,l,f,c=this.activeIndexes,u=this.selectors,h=this.selectorObjects;if(typeof e=="string"){for(t={id:this.uid++,selector:e,data:n},h[t.id]=t,l=B(this.indexes,e),o=0;o<l.length;o++)f=l[o],a=f.key,r=f.index,i=ie(c,r),i||(i=Object.create(r),i.map=new D,c.push(i)),r===this.indexes.default&&this.logDefaultIndexUsed(t),s=i.map.get(a),s||(s=[],i.map.set(a,s)),s.push(t);this.size++,u.push(e)}};d.prototype.remove=function(e,n){if(typeof e=="string"){var t,o,r,a,i,s,l,f,c=this.activeIndexes,u=this.selectors=[],h=this.selectorObjects,m={},w=arguments.length===1;for(t=B(this.indexes,e),r=0;r<t.length;r++)for(o=t[r],a=c.length;a--;)if(s=c[a],o.index.isPrototypeOf(s)){if(l=s.map.get(o.key),l)for(i=l.length;i--;)f=l[i],f.selector===e&&(w||f.data===n)&&(l.splice(i,1),m[f.id]=!0);break}for(r in m)delete h[r],this.size--;for(r in h)u.push(h[r].selector)}};function G(e,n){return e.id-n.id}d.prototype.queryAll=function(e){if(!this.selectors.length)return[];var n={},t=[],o=this.querySelectorAll(this.selectors.join(", "),e),r,a,i,s,l,f,c,u;for(r=0,i=o.length;r<i;r++)for(l=o[r],f=this.matches(l),a=0,s=f.length;a<s;a++)u=f[a],n[u.id]?c=n[u.id]:(c={id:u.id,selector:u.selector,data:u.data,elements:[]},n[u.id]=c,t.push(c)),c.elements.push(l);return t.sort(G)};d.prototype.matches=function(e){if(!e)return[];var n,t,o,r,a,i,s,l,f,c,u,h=this.activeIndexes,m={},w=[];for(n=0,r=h.length;n<r;n++)if(s=h[n],l=s.element(e),l){for(t=0,a=l.length;t<a;t++)if(f=s.map.get(l[t]))for(o=0,i=f.length;o<i;o++)c=f[o],u=c.id,!m[u]&&this.matchesSelector(e,c.selector)&&(m[u]=!0,w.push(c))}return w.sort(G)};var _=d;var M=null,O=null,L=[];function H(e,n){var t=[];function o(){var a=t;t=[],n(a)}function r(){for(var a=arguments.length,i=Array(a),s=0;s<a;s++)i[s]=arguments[s];t.push(i),t.length===1&&T(e,o)}return r}function T(e,n){O||(O=new MutationObserver(se)),M||(M=e.createElement("div"),O.observe(M,{attributes:!0})),L.push(n),M.setAttribute("data-twiddle",""+Date.now())}function se(){var e=L;L=[];for(var n=0;n<e.length;n++)try{e[n]()}catch(t){setTimeout(function(){throw t},0)}}var $=new WeakMap,x=new WeakMap,b=new WeakMap,v=new WeakMap;function N(e,n){for(var t=0;t<n.length;t++){var o=n[t],r=o[0],a=o[1],i=o[2];r===A?(le(i,a),ce(i,a)):r===U?V(i,a):r===C&&fe(e.observers,a)}}function le(e,n){if(n instanceof e.elementConstructor){var t=$.get(n);if(t||(t=[],$.set(n,t)),t.indexOf(e.id)===-1){var o=void 0;if(e.initialize&&(o=e.initialize.call(void 0,n)),o){var r=x.get(n);r||(r={},x.set(n,r)),r[""+e.id]=o}t.push(e.id)}}}function ce(e,n){if(n instanceof e.elementConstructor){var t=v.get(n);if(t||(t=[],v.set(n,t)),t.indexOf(e.id)===-1){e.elements.push(n);var o=x.get(n),r=o?o[""+e.id]:null;if(r&&r.add&&r.add.call(void 0,n),e.subscribe){var a=e.subscribe.call(void 0,n);if(a){var i=b.get(n);i||(i={},b.set(n,i)),i[""+e.id]=a}}e.add&&e.add.call(void 0,n),t.push(e.id)}}}function V(e,n){if(n instanceof e.elementConstructor){var t=v.get(n);if(!!t){var o=e.elements.indexOf(n);if(o!==-1&&e.elements.splice(o,1),o=t.indexOf(e.id),o!==-1){var r=x.get(n),a=r?r[""+e.id]:null;if(a&&a.remove&&a.remove.call(void 0,n),e.subscribe){var i=b.get(n),s=i?i[""+e.id]:null;s&&s.unsubscribe&&s.unsubscribe()}e.remove&&e.remove.call(void 0,n),t.splice(o,1)}t.length===0&&v.delete(n)}}}function fe(e,n){var t=v.get(n);if(!!t){for(var o=t.slice(0),r=0;r<o.length;r++){var a=e[o[r]];if(!!a){var i=a.elements.indexOf(n);i!==-1&&a.elements.splice(i,1);var s=x.get(n),l=s?s[""+a.id]:null;l&&l.remove&&l.remove.call(void 0,n);var f=b.get(n),c=f?f[""+a.id]:null;c&&c.unsubscribe&&c.unsubscribe(),a.remove&&a.remove.call(void 0,n)}}v.delete(n)}}var k=null;function ue(e){if(k===null){var n=e.createElement("div"),t=e.createElement("div"),o=e.createElement("div");n.appendChild(t),t.appendChild(o),n.innerHTML="",k=o.parentNode!==t}return k}function W(e){return"matches"in e||"webkitMatchesSelector"in e||"mozMatchesSelector"in e||"oMatchesSelector"in e||"msMatchesSelector"in e}var A=1,U=2,C=3;function de(e,n,t){for(var o=0;o<t.length;o++){var r=t[o];r.type==="childList"?(Q(e,n,r.addedNodes),he(e,n,r.removedNodes)):r.type==="attributes"&&I(e,n,r.target)}ue(e.ownerDocument)&&ve(e,n)}function Q(e,n,t){for(var o=0;o<t.length;o++){var r=t[o];if(W(r))for(var a=e.selectorSet.matches(r),i=0;i<a.length;i++){var s=a[i].data;n.push([A,r,s])}if("querySelectorAll"in r)for(var l=e.selectorSet.queryAll(r),f=0;f<l.length;f++)for(var c=l[f],u=c.data,h=c.elements,m=0;m<h.length;m++)n.push([A,h[m],u])}}function he(e,n,t){for(var o=0;o<t.length;o++){var r=t[o];if("querySelectorAll"in r){n.push([C,r]);for(var a=r.querySelectorAll("*"),i=0;i<a.length;i++)n.push([C,a[i]])}}}function I(e,n,t){if(W(t))for(var o=e.selectorSet.matches(t),r=0;r<o.length;r++){var a=o[r].data;n.push([A,t,a])}if("querySelectorAll"in t){var i=v.get(t);if(i)for(var s=0;s<i.length;s++){var l=e.observers[i[s]];l&&(e.selectorSet.matchesSelector(t,l.selector)||n.push([U,t,l]))}}}function me(e,n,t){if("querySelectorAll"in t){I(e,n,t);for(var o=t.querySelectorAll("*"),r=0;r<o.length;r++)I(e,n,o[r])}}function pe(e,n,t){for(var o=0;o<t.length;o++)for(var r=t[o],a=r.form?r.form.elements:e.rootNode.querySelectorAll("input"),i=0;i<a.length;i++)I(e,n,a[i])}function ve(e,n){for(var t=0;t<e.observers.length;t++){var o=e.observers[t];if(o)for(var r=o.elements,a=0;a<r.length;a++){var i=r[a];i.parentNode||n.push([C,i])}}}function ge(e,n){var t=e.readyState;t==="interactive"||t==="complete"?T(e,n):e.addEventListener("DOMContentLoaded",T(e,n))}var ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe=0;function S(e){this.rootNode=e.nodeType===9?e.documentElement:e,this.ownerDocument=e.nodeType===9?e:e.ownerDocument,this.observers=[],this.selectorSet=new _,this.mutationObserver=new MutationObserver(Me.bind(this,this)),this._scheduleAddRootNodes=H(this.ownerDocument,we.bind(this,this)),this._handleThrottledChangedTargets=H(this.ownerDocument,Ae.bind(this,this)),this.rootNode.addEventListener("change",be.bind(this,this),!1),ge(this.ownerDocument,Se.bind(this,this))}S.prototype.disconnect=function(){this.mutationObserver.disconnect()};S.prototype.observe=function(e,n){var t=void 0;typeof n=="function"?t={selector:e,initialize:n}:(typeof n>"u"?"undefined":ye(n))==="object"?(t=n,t.selector=e):t=e;var o=this,r={id:xe++,selector:t.selector,initialize:t.initialize,add:t.add,remove:t.remove,subscribe:t.subscribe,elements:[],elementConstructor:t.hasOwnProperty("constructor")?t.constructor:this.ownerDocument.defaultView.Element,abort:function(){o._abortObserving(r)}};return this.selectorSet.add(r.selector,r),this.observers[r.id]=r,this._scheduleAddRootNodes(),r};S.prototype._abortObserving=function(e){for(var n=e.elements,t=0;t<n.length;t++)V(e,n[t]);this.selectorSet.remove(e.selector,e),delete this.observers[e.id]};S.prototype.triggerObservers=function(e){var n=[];me(this,n,e),N(this,n)};function Se(e){e.mutationObserver.observe(e.rootNode,{childList:!0,attributes:!0,subtree:!0}),e._scheduleAddRootNodes()}function we(e){var n=[];Q(e,n,[e.rootNode]),N(e,n)}function Me(e,n){var t=[];de(e,t,n),N(e,t)}function be(e,n){e._handleThrottledChangedTargets(n.target)}function Ae(e,n){var t=[];pe(e,t,n),N(e,t)}var E=void 0;function Ce(){return E||(E=new S(window.document)),E}function F(){var e;return(e=Ce()).observe.apply(e,arguments)}var R="gcla-processed";document.head.append(g.createElement("style",null,`.${R}.rgh-collaborator { padding: 2px 5px 4px; }`));F(`:is(.js-issue-row, .js-pinned-issue-list-item) [data-hovercard-type="user"]:not(.${R})`,{add(e){e.classList.add(R);let n=e.textContent,t=`@${n}`,o=document.querySelector(`[alt="${t}"]`)?.src||`https://avatars.githubusercontent.com/${n}?size=32`;e.prepend(g.createElement("img",{className:"avatar avatar-user",src:o,width:"16",height:"16",alt:t,loading:"lazy",decoding:"async"})," ")}});})();
