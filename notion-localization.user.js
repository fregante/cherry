// ==UserScript==
// @name         Notion Localization
// @version      5
// @description  Enable Notion's native localization for more languages
// @author       kidonng
// @namespace    https://github.com/kidonng/cherry
// @match        https://www.notion.so/*
// @run-at       document-start
// ==/UserScript==
(()=>{var w=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","animation","audio","canvas","circle","clipPath","color-profile","cursor","defs","desc","discard","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","handler","hkern","iframe","image","line","linearGradient","listener","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","prefetch","radialGradient","rect","script","set","solidColor","stop","style","svg","switch","symbol","tbreak","text","textArea","textPath","title","tref","tspan","unknown","use","video","view","vkern"],l=new Set(w);l.delete("a");l.delete("audio");l.delete("canvas");l.delete("iframe");l.delete("script");l.delete("video");var S=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,N=e=>e===DocumentFragment,k=(e,o)=>{for(let[t,s]of Object.entries(o))t.startsWith("-")?e.style.setProperty(t,s):typeof s=="number"&&!S.test(t)?e.style[t]=`${s}px`:e.style[t]=s},C=e=>typeof e=="string"?l.has(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e):N(e)?document.createDocumentFragment():e(e.defaultProps),p=(e,o,t)=>{t!=null&&(/^xlink[AHRST]/.test(o)?e.setAttributeNS("http://www.w3.org/1999/xlink",o.replace("xlink","xlink:").toLowerCase(),t):e.setAttribute(o,t))},u=(e,o)=>{for(let t of o)t instanceof Node?e.appendChild(t):Array.isArray(t)?u(e,t):typeof t!="boolean"&&typeof t<"u"&&t!==null&&e.appendChild(document.createTextNode(t))},L=(e,o,...t)=>{var s;let a=C(e);if(u(a,t),a instanceof DocumentFragment||!o)return a;for(let[n,r]of Object.entries(o))if(n==="htmlFor"&&(n="for"),n==="class"||n==="className"){let i=(s=a.getAttribute("class"))!==null&&s!==void 0?s:"";p(a,"class",(i+" "+String(r)).trim())}else if(n==="style")k(a,r);else if(n.startsWith("on")){let i=n.slice(2).toLowerCase().replace(/^-/,"");a.addEventListener(i,r)}else n==="dangerouslySetInnerHTML"&&"__html"in r?a.innerHTML=r.__html:n!=="key"&&r!==!1&&p(a,n,r===!0?"":r);return a},F=typeof DocumentFragment=="function"?DocumentFragment:()=>{},_={createElement:L,Fragment:F},c=_;var m=e=>{if(e==null)return new DocumentFragment;let o=document.createElement("template");return o.innerHTML=e,o.content};m.one=e=>{var o;return(o=m(e).firstElementChild)!==null&&o!==void 0?o:void 0};var f=m;(async()=>{let e=localStorage.getItem("ajs_user_traits");if(!e)return;let{app_version:o,locale:t,is_desktop:s,preferred_locale:a}=JSON.parse(e),n="i10n-meta",r="i10n-messages";if(localStorage.getItem(n)===`${o}-${t}`){let i=()=>document.documentElement.prepend(c.createElement("script",{id:"messages",type:"application/json","data-locale":a},localStorage.getItem(r)));s?document.addEventListener("readystatechange",i,{once:!0}):i();return}try{let i=await fetch("/api/v3/getAssetsJsonV2",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({hash:""})}),{localeHtml:d,version:g}=await i.json();if(!(t in d))return;let h=d[t],y=await(await fetch(h)).text(),v=f(y),{textContent:x}=v.querySelector("#messages");localStorage.setItem(n,`${g}-${t}`),localStorage.setItem(r,x),confirm("Notion Localization data updated successfully \u2728, would you like to reload?")&&(location.pathname="/")}catch(i){alert(`Notion Localization data failed to update \u{1F622}

${i}`)}})();})();
